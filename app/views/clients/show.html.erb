<p id="notice"><%= notice %></p>

<p>
  <strong>Name:</strong>
  <%= @client.name %>
</p>

<%= link_to 'Back', clients_path %>


<h2> 2012 Payments: </h2> 
<h3> $<%= @client.all_payments%> </h3>

<h2> Lobbyists Hired: </h2>
<h3> <%= @client.lobbyists.uniq.length %> </h3>

<h2> Agencies Lobbied: </h2>
<h3> <%= @client.find_agencies %> </h3>

<h2> Actions Sought: </h2>
<h3> <%= @client.actions.length %> </h3>

<ul class="nav nav-tabs">
  <li class="active"><a href="#home" data-toggle="tab">Actions</a></li>
  <li><a href="#lobbyists" data-toggle="tab">Lobbyists</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="home">
    <table class="table table-striped table-bordered table-condensed clientTable" border='1'>
      <thead>
        <tr>
          <th style="cursor: pointer; cursor: hand;"> <a> Lobbyist </a> </th>
          <th style="cursor: pointer; cursor: hand;"><a id="payments"> Agency</a></th>
          <th style="cursor: pointer; cursor: hand;"><a id="payments"> Amount</a></th>
        </tr>
      </thead>

      <tbody>
        <% @client.actions.sort_by { |action| -action.payment}.each do |action| %>
          <tr>
            <td valign="top"> <% action.lobbyists.each do |lobbyist| %>
              <%= link_to lobbyist.name, lobbyist_path(lobbyist.slug) %> <br>
            <%end%> </td> 
            <td valign="top"> <% action.agencies.each do |agency| %>
              <%= link_to agency.name, agency_path(agency.slug) %> <br>
            <%end%> </td>
            <td valign="top">$<%= action.payment %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="tab-pane" id="lobbyists">
    <table class="table table-striped table-bordered table-condensed clientTable" border='1'>
      <thead>
        <tr>
          <th style="cursor: pointer; cursor: hand;"> <a> Lobbyist </a> </th>
          <th style="cursor: pointer; cursor: hand;"> <a> Firm </a> </th>
          <th style="cursor: pointer; cursor: hand;"> <a> Amount to person</a></th>
          <th style="cursor: pointer; cursor: hand;"> <a> Amount paid to team</a></th>
        </tr>
      </thead>

      <tbody>
        <% @client.find_lobbyists_and_payments.sort_by{ |k,v| -([v].inject(:+).join.to_i)}.each do |lobbyist, payment| %>
          <tr>
            <td valign="top"><%= link_to lobbyist.name, lobbyist_path(lobbyist.slug) %> </td>
            <td valign="top"><%= link_to lobbyist.firm.name, firm_path(lobbyist.firm.slug) %></td>
            <td valign="top">$<%= payment[0] %></td>
            <td valign="top">$<%= payment[1] %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
